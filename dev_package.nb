(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     72933,       1852]
NotebookOptionsPosition[     72131,       1830]
NotebookOutlinePosition[     72527,       1846]
CellTagsIndexPosition[     72484,       1843]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Package", "Title",
 CellChangeTimes->{{3.902837718029646*^9, 
  3.902837718696806*^9}},ExpressionUUID->"cfe02fac-2679-4ae1-928a-\
baf699bfc0bd"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BeginPackage", "[", "\"\<LoopEquationsGenerator`\>\"", "]"}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateAllResolventLoopEquations", "::", "usage"}], "=", 
   "\"\<Generate all resolvent loop equations.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateIndividualResolventLoopEquation", "::", "usage"}], "=", 
   "\"\<Generate an individual resolvent loop equation.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateAllCorrelatorLoopEquations", "::", "usage"}], "=", 
   "\"\<Generate all correlator loop equations.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateIndividualCorrelatorLoopEquation", "::", "usage"}], "=", 
   "\"\<Generate an individual correlator loop equation.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"InitializeLoopEquationsPackage", "::", "usage"}], "=", 
   "\"\<Initialize the package with action, fundamentalMatrix, and \
maxLevel.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetResolventVariables", "::", "usage"}], "=", 
   "\"\<Return list of all resolvent variables.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetCorrelatorVariables", "::", "usage"}], "=", 
   "\"\<Return list of all correlator variables.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetResolventLoopEquationLevel", "::", "usage"}], "=", 
   "\"\<Get level of an input resolvent loop equation.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetCorrelatorLoopEquationLevel", "::", "usage"}], "=", 
   "\"\<Get level of an input correlator loop equation.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetVariationList", "::", "usage"}], "=", 
    "\"\<Get a list of all possible words corresponding to variations.\>\""}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"extractIndices", "[", 
     RowBox[{"term_", ",", "symbol_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"factors", ",", "mFactors", ",", "subs"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"AtomQ", "[", "term", "]"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"{", "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"term", "===", "symbol"}], "||", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "term", "]"}], "===", "Subscript"}], "&&", 
           RowBox[{
            RowBox[{"term", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "===", "symbol"}]}]}], ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "term", "]"}], "===", "Subscript"}], ",", 
           RowBox[{"Return", "[", 
            RowBox[{"Sort", "[", 
             RowBox[{"Sequence", "@@", 
              RowBox[{"term", "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
           RowBox[{"Return", "[", 
            RowBox[{"{", "}"}], "]"}]}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"factors", "=", 
        RowBox[{"List", "@@", "term"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mFactors", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"factors", ",", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"FreeQ", "[", 
             RowBox[{"#", ",", 
              RowBox[{"Subscript", "[", 
               RowBox[{"symbol", ",", "_"}], "]"}]}], "]"}]}], "&"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"subs", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Replace", "[", 
          RowBox[{"mFactors", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"Subscript", "[", 
               RowBox[{"_", ",", "sub_"}], "]"}], ":>", 
              RowBox[{"{", "sub", "}"}]}], ",", 
             RowBox[{
              RowBox[{"Power", "[", 
               RowBox[{
                RowBox[{"Subscript", "[", 
                 RowBox[{"_", ",", "sub_"}], "]"}], ",", "pow_"}], "]"}], ":>", 
              RowBox[{"Table", "[", 
               RowBox[{"sub", ",", 
                RowBox[{"{", "pow", "}"}]}], "]"}]}]}], "}"}], ",", 
           RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Sort", "[", "subs", "]"}]}]}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"augmentList", "[", "listOfLists_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"reversed", ",", "augmented"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"reversed", "=", 
        RowBox[{"Reverse", "/@", "listOfLists"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"augmented", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"listOfLists", ",", "reversed"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"DeleteDuplicates", "[", "augmented", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"extractAllActionIndices", "[", "expr_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "rawIndices", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rawIndices", "=", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"extractIndices", "[", 
             RowBox[{"#", ",", "M"}], "]"}], "&"}], ",", 
           RowBox[{"List", "@@", 
            RowBox[{"Expand", "[", "expr", "]"}]}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Reverse", "[", 
        RowBox[{"Sort", "[", " ", 
         RowBox[{"augmentList", "[", "rawIndices", "]"}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getLoopSchema", "[", "action_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "vars", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vars", "=", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Cases", "[", 
          RowBox[{"action", ",", 
           RowBox[{"Subscript", "[", 
            RowBox[{"M", ",", "_"}], "]"}], ",", "Infinity"}], "]"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"derivatives", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Expand", "@", 
           RowBox[{"Simplify", "@", 
            RowBox[{"D", "[", 
             RowBox[{"action", ",", "#"}], "]"}]}]}], "&"}], "/@", "vars"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"Reverse", "@", 
        RowBox[{"Sort", "[", 
         RowBox[{"DeleteDuplicates", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{"extractAllActionIndices", ",", "derivatives"}], "]"}], 
            ",", "1"}], "]"}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"matrixProductFromIndexList", "[", "list_", "]"}], ":=", 
    RowBox[{"Times", "@@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"Subscript", "[", 
         RowBox[{"M", ",", "#"}], "]"}], "&"}], "/@", "list"}], ")"}]}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"extractCoefficients", "[", 
     RowBox[{"S_", ",", "matrixIndex_", ",", "schema_"}], "]"}], ":=", 
    RowBox[{"If", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"schema", "==", 
       RowBox[{"Reverse", "[", "schema", "]"}]}], ",", "\[IndentingNewLine]", 
      
      RowBox[{"Coefficient", "[", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"S", ",", 
          SubscriptBox["M", "matrixIndex"]}], "]"}], ",", 
        RowBox[{"matrixProductFromIndexList", "[", "schema", "]"}]}], "]"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"Coefficient", "[", 
        RowBox[{
         RowBox[{"D", "[", 
          RowBox[{"S", ",", 
           SubscriptBox["M", "matrixIndex"]}], "]"}], ",", 
         RowBox[{"matrixProductFromIndexList", "[", "schema", "]"}]}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"createAllResolventWords", "[", "length_", "]"}], ":=", 
    RowBox[{"If", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"length", "==", "1"}], ",", 
      RowBox[{"Tuples", "[", 
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{"matrixIndexRange", ",", "0"}], "]"}], ",", "1"}], "]"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"length", "==", "2"}], ",", 
        RowBox[{"Tuples", "[", 
         RowBox[{
          RowBox[{"DeleteCases", "[", 
           RowBox[{"matrixIndexRange", ",", "0"}], "]"}], ",", "2"}], "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Prepend", "[", 
             RowBox[{
              RowBox[{"Append", "[", 
               RowBox[{"inner", ",", "last"}], "]"}], ",", "first"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"first", ",", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{"matrixIndexRange", ",", "0"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"last", ",", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{"matrixIndexRange", ",", "0"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"inner", ",", 
              RowBox[{"Tuples", "[", 
               RowBox[{"matrixIndexRange", ",", 
                RowBox[{"length", "-", "2"}]}], "]"}]}], "}"}]}], "]"}], ",", 
          "2"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"checkIfResolventWordRedundant", "[", 
     RowBox[{"word_", ",", "positionInList_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"length", ",", " ", "remainingWordsList"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"length", "=", 
        RowBox[{"Length", "[", "word", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"remainingWordsList", "=", 
        RowBox[{"Part", "[", 
         RowBox[{
          RowBox[{"Reverse", "[", 
           RowBox[{"createAllResolventWords", "[", "length", "]"}], "]"}], 
          ",", 
          RowBox[{
           RowBox[{"positionInList", "+", "1"}], ";;"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"remainingWordsList", ",", 
           RowBox[{"Reverse", "[", "word", "]"}]}], "]"}], ",", "0", ",", 
         "word"}], "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"createUniqueResolventWords", "[", "level_", "]"}], ":=", 
    RowBox[{"DeleteCases", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"checkIfResolventWordRedundant", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Reverse", "[", 
            RowBox[{"createAllResolventWords", "[", "level", "]"}], "]"}], 
           "[", 
           RowBox[{"[", "i", "]"}], "]"}], ",", "i"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"createAllResolventWords", "[", "level", "]"}], "]"}]}], 
         "}"}]}], "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
      "0"}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"createAllCorrelatorWords", "[", "level_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "iteratorList", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"iteratorList", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            SubscriptBox["i", "j"], ",", "matrixIndexRange"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "level"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             SubscriptBox["i", "j"], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", "level"}], "}"}]}], "]"}], ",", " ", 
           RowBox[{
            RowBox[{"Sequence", "@@", "iteratorList"}], "//", "Evaluate"}]}], 
          "]"}], ",", 
         RowBox[{"level", "-", "1"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"checkIfCorrelatorWordRedundant", "[", 
     RowBox[{"word_", ",", "precedingWordPositionInList_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "length", ",", "remainingWordsList", ",", " ", 
        "wordIncludingHermitianConjugateList"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"length", "=", 
        RowBox[{"Length", "[", "word", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"remainingWordsList", "=", 
        RowBox[{"Part", "[", 
         RowBox[{
          RowBox[{"createAllCorrelatorWords", "[", "length", "]"}], ",", 
          RowBox[{";;", "precedingWordPositionInList"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wordIncludingHermitianConjugateList", "=", 
        RowBox[{"{", 
         RowBox[{"word", ",", 
          RowBox[{"Reverse", "[", "word", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"wordIncludingHermitianConjugateList", "[", 
           RowBox[{"[", "k", "]"}], "]"}], "=", 
          RowBox[{"NestList", "[", 
           RowBox[{"RotateRight", ",", 
            RowBox[{"wordIncludingHermitianConjugateList", "[", 
             RowBox[{"[", "k", "]"}], "]"}], ",", 
            RowBox[{"length", "-", "1"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "2"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"IntersectingQ", "[", 
          RowBox[{"remainingWordsList", ",", 
           RowBox[{"Join", "@@", "wordIncludingHermitianConjugateList"}]}], 
          "]"}], ",", "0", ",", 
         RowBox[{"wordIncludingHermitianConjugateList", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"createUniqueCorrelatorWords", "[", "level_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "allCorrelatorWords", ",", "WordsByTraceSymmetry"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allCorrelatorWords", "=", 
        RowBox[{"createAllCorrelatorWords", "[", "level", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"DeleteCases", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "checkIfCorrelatorWordRedundant", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"allCorrelatorWords", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"Length", "[", "allCorrelatorWords", "]"}], "+", "1", 
                "-", "i"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Length", "[", "allCorrelatorWords", "]"}], "-", 
              "i"}]}], "\[IndentingNewLine]", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "allCorrelatorWords", "]"}]}], "}"}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", "0"}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"createVariations", "[", "level_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "uniquePartitions", ",", "createTableIterator", ",", " ", 
        "createWordPartitions"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"level", "!=", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"uniquePartitions", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"i", "\[NotEqual]", "0"}], ",", 
              RowBox[{"Partition", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{"0", ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "1", ",", "level"}], "}"}]}], "]"}], ",", 
                RowBox[{"UpTo", "[", 
                 RowBox[{"level", "-", "i"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{"0", ",", 
                  RowBox[{"{", 
                   RowBox[{"k", ",", "1", ",", "level"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", "}"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", 
              RowBox[{"Floor", "[", 
               FractionBox["level", "2"], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"createTableIterator", "[", "partition_", "]"}], ":=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"partition", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], "\[NotEqual]", "0"}], 
            ",", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  SubscriptBox["i", "j"], ",", "matrixIndexRange"}], "}"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "1", ",", 
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"partition", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], 
                 "}"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{
                 SubscriptBox["i", 
                  RowBox[{"Length", "[", 
                   RowBox[{"partition", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]], ",", 
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{"matrixIndexRange", ",", "0"}], "]"}]}], "}"}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{
                 SubscriptBox["j", 
                  RowBox[{"Length", "[", 
                   RowBox[{"partition", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]], ",", 
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{"matrixIndexRange", ",", "0"}], "]"}]}], "}"}], 
               "}"}], ",", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  SubscriptBox["j", "i"], ",", "matrixIndexRange"}], "}"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"partition", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "-", "1"}]}], 
                 "}"}]}], "]"}]}], "]"}], ",", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  SubscriptBox["i", "j"], ",", "matrixIndexRange"}], "}"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "1", ",", 
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"partition", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], 
                 "}"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"{", 
                RowBox[{
                 SubscriptBox["i", 
                  RowBox[{"Length", "[", 
                   RowBox[{"partition", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]], ",", 
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{"matrixIndexRange", ",", "0"}], "]"}]}], "}"}], 
               "}"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"createWordPartitions", "[", "partition_", "]"}], ":=", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  SubscriptBox["i", "j"], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"partition", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"partition", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "\[NotEqual]", 
                   "0"}], ",", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    SubscriptBox["j", "i"], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"partition", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                  ",", 
                  RowBox[{"{", "}"}]}], "]"}]}], "}"}], ",", " ", 
              RowBox[{
               RowBox[{"Sequence", "@@", 
                RowBox[{"createTableIterator", "[", "partition", "]"}]}], "//",
                "Evaluate"}]}], "]"}], ",", 
            RowBox[{"level", "-", "1"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{"createWordPartitions", ",", "uniquePartitions"}], "]"}], 
           ",", "1"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}]}], "}"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"InitializeLoopEquationsPackage", "[", 
     RowBox[{
     "action_", ",", "matrixDOF_", ",", "orientationMatrix_", ",", 
      "maxLevelValue_", ",", "resolventSymbol_", ",", "correlatorSymbol_", 
      ",", "argumentSymbol_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "localAction", ",", "originalMatrixVars", ",", 
        "originalMatrixIndexRange", ",", "orientationInverse", ",", 
        "transformation"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"orientationInverse", "=", 
        RowBox[{"Simplify", "@", 
         RowBox[{"PowerExpand", "[", 
          RowBox[{"Inverse", "[", "orientationMatrix", "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"transformation", "=", 
        RowBox[{"(", 
         RowBox[{"orientationInverse", ".", 
          RowBox[{"Table", "[", 
           RowBox[{
            SubscriptBox["M", "i"], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", 
              RowBox[{
               RowBox[{"Length", "[", "matrixDOF", "]"}], "-", "1"}]}], 
             "}"}]}], "]"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"S", "=", 
        RowBox[{"action", "/.", " ", 
         RowBox[{"Thread", "[", 
          RowBox[{"matrixDOF", "->", "transformation"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"matrixVars", "=", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Cases", "[", 
          RowBox[{"S", ",", 
           RowBox[{"Subscript", "[", 
            RowBox[{"M", ",", "_"}], "]"}], ",", "Infinity"}], "]"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"matrixIndexRange", "=", 
        RowBox[{"matrixVars", "/.", " ", 
         RowBox[{
          RowBox[{"Subscript", "[", 
           RowBox[{"M", ",", "n_"}], "]"}], ":>", "n"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"loopSchema", "=", 
        RowBox[{"getLoopSchema", "[", "S", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"actionCoefficients", "=", 
        RowBox[{"Simplify", "@", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"extractCoefficients", "[", 
              RowBox[{"S", ",", "matrixIndex", ",", "schema"}], "]"}], "/.", 
             " ", 
             RowBox[{"Thread", "[", 
              RowBox[{"matrixVars", "->", "0"}], "]"}]}], ")"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"matrixIndex", ",", "matrixIndexRange"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"schema", ",", "loopSchema"}], "}"}]}], 
          "\[IndentingNewLine]", "]"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"maxLevel", "=", "maxLevelValue"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"resolventWords", "[", "level", "]"}], "=", 
          RowBox[{"createUniqueResolventWords", "[", "level", "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"level", ",", "1", ",", "maxLevel"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"correlatorWords", "[", "level", "]"}], "=", 
          RowBox[{"createUniqueCorrelatorWords", "[", "level", "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"level", ",", "1", ",", "maxLevel"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"variations", "[", "level", "]"}], "=", 
          RowBox[{"createVariations", "[", "level", "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"level", ",", "0", ",", 
           RowBox[{"maxLevel", "-", "2"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"\[Omega]", "=", "resolventSymbol"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"p", "=", "correlatorSymbol"}], ";", "\[IndentingNewLine]", 
       RowBox[{"z", "=", "argumentSymbol"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        SubscriptBox["p", 
         RowBox[{"{", "}"}]], "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        SubscriptBox["p", "Null"], "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        SubscriptBox["\[Omega]", 
         RowBox[{"{", "}"}]], "=", "\[Omega]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        SubscriptBox["\[Omega]", "Null"], "=", "\[Omega]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"correlatorWordLookup", "[", "word_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"length", ",", "symmetricWordList", ",", "symmetricWord"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"length", "=", 
        RowBox[{"Length", "[", "word", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"length", "\[Equal]", "0"}], ",", 
         RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"symmetricWordList", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              SubscriptBox["symmetricWord", 
               RowBox[{"{", 
                RowBox[{"i", ",", "j"}], "}"}]], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "2"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", "maxLevel"}], "}"}]}], "]"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           SubscriptBox["symmetricWord", 
            RowBox[{"{", 
             RowBox[{"1", ",", "1"}], "}"}]], "=", "word"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "2"}], ",", 
            RowBox[{"i", "\[LessEqual]", "length"}], ",", 
            RowBox[{"i", "++"}], ",", 
            RowBox[{
             SubscriptBox["symmetricWord", 
              RowBox[{"{", 
               RowBox[{"1", ",", "i"}], "}"}]], "=", 
             RowBox[{"RotateRight", "[", 
              SubscriptBox["symmetricWord", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}]}], "}"}]], "]"}]}]}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{
           SubscriptBox["symmetricWord", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}]], "=", 
           RowBox[{"Reverse", "[", "word", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "2"}], ",", 
            RowBox[{"i", "\[LessEqual]", "length"}], ",", 
            RowBox[{"i", "++"}], ",", 
            RowBox[{
             SubscriptBox["symmetricWord", 
              RowBox[{"{", 
               RowBox[{"2", ",", "i"}], "}"}]], "=", 
             RowBox[{"RotateRight", "[", 
              SubscriptBox["symmetricWord", 
               RowBox[{"{", 
                RowBox[{"2", ",", 
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}]}], "}"}]], "]"}]}]}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"Which", "@@", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"MemberQ", "[", 
                  RowBox[{
                   RowBox[{"correlatorWords", "[", "length", "]"}], ",", 
                   SubscriptBox["symmetricWord", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "j"}], "}"}]]}], "]"}], ",", 
                 SubscriptBox["symmetricWord", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "j"}], "}"}]]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "2"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "1", ",", "length"}], "}"}]}], "]"}], ",", 
             "2"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"resolventWordLookup", "[", "word_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"length", ",", "symmetricWord"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"length", "=", 
        RowBox[{"Length", "[", "word", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"length", "==", "0"}], ",", 
         RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           SubscriptBox["symmetricWord", "1"], "=", "word"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           SubscriptBox["symmetricWord", "2"], "=", 
           RowBox[{"Reverse", "[", "word", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Which", "[", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"resolventWords", "[", "length", "]"}], ",", 
              SubscriptBox["symmetricWord", "1"]}], "]"}], ",", 
            SubscriptBox["symmetricWord", "1"], ",", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"resolventWords", "[", "length", "]"}], ",", 
              SubscriptBox["symmetricWord", "2"]}], "]"}], ",", 
            SubscriptBox["symmetricWord", "2"]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"splitWordOnResolventLetter", "[", "word_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "x", ",", "rightmostResolventLetterPosition", ",", 
        "subwordsListAfterSplit"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "word", "]"}], "\[NotEqual]", "0"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "word", "]"}], "\[NotEqual]", 
            RowBox[{"Length", "[", 
             RowBox[{"Position", "[", 
              RowBox[{"word", ",", "0"}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"rightmostResolventLetterPosition", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Position", "[", 
                RowBox[{"word", ",", 
                 RowBox[{"_", "?", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"#", "\[NotEqual]", "0"}], "&"}], ")"}]}], ",", 
                 "1", ",", "1"}], "]"}], "-", 
               RowBox[{"{", 
                RowBox[{"{", "1", "}"}], "}"}], "+", 
               RowBox[{"Position", "[", 
                RowBox[{
                 RowBox[{"Reverse", "[", "word", "]"}], ",", 
                 RowBox[{"_", "?", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"#", "\[NotEqual]", "0"}], "&"}], ")"}]}], ",", 
                 "1", ",", "1"}], "]"}], "-", 
               RowBox[{"{", 
                RowBox[{"{", "1", "}"}], "}"}]}], ")"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"subwordsListAfterSplit", "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{"0", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{
                    RowBox[{"rightmostResolventLetterPosition", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"word", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"word", ",", 
                    RowBox[{"_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", "\[NotEqual]", "0"}], "&"}], ")"}]}], ",", 
                    "1", ",", "1"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{
                    RowBox[{"Length", "[", "word", "]"}], "-", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"Reverse", "[", "word", "]"}], ",", 
                    RowBox[{"_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", "\[NotEqual]", "0"}], "&"}], ")"}]}], ",", 
                    "1", ",", "1"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1"}]}], "}"}]}], 
                "]"}]}], "}"}]}], ";"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"subwordsListAfterSplit", "=", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{"0", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"word", ",", "0"}], "]"}], "]"}]}], "}"}]}], 
                "]"}], ",", 
               RowBox[{"{", "}"}]}], "}"}]}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"subwordsListAfterSplit", "=", 
           RowBox[{"{", "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "subwordsListAfterSplit"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"splitWordResolventWordLookup", "[", "word_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", "word", "]"}], "\[NotEqual]", "0"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"splitWordOnResolventLetter", "[", "word", "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"resolventWordLookup", "[", 
        RowBox[{
         RowBox[{"splitWordOnResolventLetter", "[", "word", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", "}"}]}], "}"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[CapitalDelta]", "[", 
     RowBox[{"word_", ",", "numberResolventLettersToAdd_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"remainingWord", ",", "remainingCorrelatorWord", ",", "n"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", "=", "numberResolventLettersToAdd"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"remainingWord", "=", 
        RowBox[{
         RowBox[{"splitWordResolventWordLookup", "[", "word", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"remainingCorrelatorWord", "[", "lettersAdded_", "]"}], ":=", 
        
        RowBox[{"correlatorWordLookup", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Append", "[", 
           RowBox[{"remainingWord", ",", 
            RowBox[{"Table", "[", 
             RowBox[{"0", ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                RowBox[{"lettersAdded", "-", "1"}]}], "}"}]}], "]"}]}], "]"}],
           "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"n", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
         SubscriptBox["\[Omega]", "remainingWord"], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           SuperscriptBox["z", "n"], 
           SubscriptBox["\[Omega]", "remainingWord"]}], "-", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{
             SuperscriptBox["z", 
              RowBox[{"n", "-", "m"}]], "  ", 
             SubscriptBox["p", 
              RowBox[{"remainingCorrelatorWord", "[", "m", "]"}]]}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "1", ",", "n"}], "}"}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"createWordsGeneratedByActionVariation", "[", "wordList_", "]"}], 
    ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"Append", "[", 
        RowBox[{"#", ",", 
         RowBox[{"wordList", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}], "&"}], "/@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"Prepend", "[", 
          RowBox[{"#", ",", 
           RowBox[{"wordList", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}], "&"}], "/@", 
       "loopSchema"}], ")"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"resolventActionContribution", "[", 
     RowBox[{"wordList_", ",", "matrixNumber_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "coefficients", ",", "wordsGeneratedByActionVariation", ",", 
        "splitAndReducedWords", ",", " ", "resolventExpressions"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"coefficients", "=", 
        RowBox[{"actionCoefficients", "[", 
         RowBox[{"[", 
          RowBox[{"matrixNumber", "+", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wordsGeneratedByActionVariation", "=", 
        RowBox[{
        "createWordsGeneratedByActionVariation", "[", "wordList", "]"}]}], 
       ";", 
       RowBox[{"splitAndReducedWords", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
         "splitWordResolventWordLookup", ",", 
          "wordsGeneratedByActionVariation"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"resolventExpressions", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"\[CapitalDelta]", "[", 
           RowBox[{
            RowBox[{"splitAndReducedWords", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"Length", "[", 
             RowBox[{"splitAndReducedWords", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "loopSchema", "]"}]}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"coefficients", ".", "resolventExpressions"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"splitWordListOnLetter", "[", 
     RowBox[{"wordList_", ",", "matrixNumber_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"resolventLetterPositionList", ",", " ", "splitWordList"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"resolventLetterPositionList", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"wordList", ",", "matrixNumber"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"splitWordList", "[", "splitPointList_", "]"}], ":=", 
        RowBox[{"If", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"splitPointList", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "1"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"wordList", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{";;", 
               RowBox[{
                RowBox[{"splitPointList", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "-", "1"}]}], "]"}], "]"}], 
            ",", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"wordList", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"wordList", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"splitPointList", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], ";;"}], "]"}], 
               "]"}]}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"wordList", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{
                RowBox[{"splitPointList", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], ";;"}], "]"}], 
             "]"}], ",", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"wordList", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{";;", 
                 RowBox[{
                  RowBox[{"splitPointList", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "-", "1"}]}], "]"}], "]"}],
               ",", 
              RowBox[{"wordList", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"splitWordList", "/@", "resolventLetterPositionList"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"resolventJacobianContribution", "[", 
     RowBox[{"wordList_", ",", "matrixNumber_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "splitWordList", ",", " ", "left", ",", " ", "right", ",", 
        "resolventContribution", ",", "wordContributionResolvents", ",", 
        "wordContributionCorrelatorWords", ",", "wordContribution"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"left", "=", 
        RowBox[{"wordList", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"right", "=", 
        RowBox[{"wordList", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"splitWordList", "=", 
        RowBox[{"splitWordListOnLetter", "[", 
         RowBox[{"wordList", ",", "matrixNumber"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"resolventContribution", "=", 
        RowBox[{
         RowBox[{"\[CapitalDelta]", "[", 
          RowBox[{"left", ",", 
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{"splitWordResolventWordLookup", "[", "left", "]"}], "[", 
             
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "*", 
         RowBox[{"\[CapitalDelta]", "[", 
          RowBox[{"right", ",", 
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{"splitWordResolventWordLookup", "[", "right", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wordContributionResolvents", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"\[CapitalDelta]", "[", 
           RowBox[{
            RowBox[{"splitWordList", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"splitWordResolventWordLookup", "[", 
               RowBox[{"splitWordList", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "splitWordList", "]"}]}], "}"}]}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"wordContributionCorrelatorWords", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"correlatorWordLookup", "[", 
           RowBox[{"splitWordList", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "splitWordList", "]"}]}], "}"}]}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"wordContribution", "=", 
        RowBox[{"wordContributionResolvents", ".", 
         RowBox[{"(", 
          RowBox[{"List", "@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Subscript", "[", 
               RowBox[{"p", ",", "#"}], "]"}], "&"}], "/@", 
             "wordContributionCorrelatorWords"}], ")"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"matrixNumber", "==", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{"resolventContribution", "+", "wordContribution"}], ",", 
         "\[IndentingNewLine]", "wordContribution"}], "\[IndentingNewLine]", 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"createResolventLoopEquation", "[", 
     RowBox[{"wordList_", ",", "matrixNumber_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"resolventActionContribution", "[", 
      RowBox[{"wordList", ",", "matrixNumber"}], "]"}], "-", 
     RowBox[{"resolventJacobianContribution", "[", 
      RowBox[{"wordList", ",", "matrixNumber"}], "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"correlatorActionContribution", "[", 
     RowBox[{"wordList_", ",", "matrixNumber_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "coefficients", ",", "wordsGeneratedByActionVariation", ",", 
        "reducedWords", ",", "correlatorList"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"coefficients", "=", 
        RowBox[{"actionCoefficients", "[", 
         RowBox[{"[", 
          RowBox[{"matrixNumber", "+", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wordsGeneratedByActionVariation", "=", 
        RowBox[{
        "createWordsGeneratedByActionVariation", "[", "wordList", "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"reducedWords", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
         "correlatorWordLookup", ",", "wordsGeneratedByActionVariation"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"correlatorList", "=", 
        RowBox[{"List", "@@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Subscript", "[", 
             RowBox[{"p", ",", "#"}], "]"}], "&"}], "/@", "reducedWords"}], 
          ")"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"coefficients", ".", "correlatorList"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"correlatorJacobianContribution", "[", 
    RowBox[{"wordList_", ",", "matrixNumber_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "splitWordList", ",", "leftJacobianIndex", ",", "rightJacobianIndex"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"splitWordList", "=", 
       RowBox[{"splitWordListOnLetter", "[", 
        RowBox[{"wordList", ",", " ", "matrixNumber"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"splitWordList", "!=", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"leftJacobianIndices", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"correlatorWordLookup", "[", 
             RowBox[{"splitWordList", "[", 
              RowBox[{"[", 
               RowBox[{"splitNumber", ",", "1"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"splitNumber", ",", "1", ",", 
              RowBox[{"Length", "[", "splitWordList", "]"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"rightJacobianIndices", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"correlatorWordLookup", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Append", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"splitWordResolventWordLookup", "[", 
                  RowBox[{"splitWordList", "[", 
                   RowBox[{"[", 
                    RowBox[{"splitNumber", ",", "2"}], "]"}], "]"}], "]"}], 
                 "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", 
                RowBox[{"Table", "[", 
                 RowBox[{"0", ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"splitWordResolventWordLookup", "[", 
                    RowBox[{"splitWordList", "[", 
                    RowBox[{"[", 
                    RowBox[{"splitNumber", ",", "2"}], "]"}], "]"}], "]"}], 
                    "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}],
                "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"splitNumber", ",", "1", ",", 
              RowBox[{"Length", "[", "splitWordList", "]"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"List", "@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Subscript", "[", 
                RowBox[{"p", ",", "#"}], "]"}], "&"}], "/@", 
              "leftJacobianIndices"}], ")"}]}], ")"}], ".", 
          RowBox[{"(", 
           RowBox[{"List", "@@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Subscript", "[", 
                RowBox[{"p", ",", "#"}], "]"}], "&"}], "/@", 
              "rightJacobianIndices"}], ")"}]}], ")"}]}]}], ",", 
        "\[IndentingNewLine]", "0"}], "\[IndentingNewLine]", "]"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"createCorrelatorLoopEquation", "[", 
     RowBox[{"wordList_", ",", "matrixNumber_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"correlatorActionContribution", "[", 
      RowBox[{"wordList", ",", "matrixNumber"}], "]"}], "-", 
     RowBox[{"correlatorJacobianContribution", "[", 
      RowBox[{"wordList", ",", "matrixNumber"}], "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getVariationList", "[", "level_", "]"}], ":=", 
    RowBox[{"If", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"level", "==", "0"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", "}"}], ",", 
        RowBox[{"{", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", "}"}]}], "}"}], "}"}], ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"variations", "[", "i", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "level"}], "}"}]}], "]"}], ",", 
          "1"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GenerateAllResolventLoopEquations", "[", "level_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "variationList", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"variationList", "=", 
        RowBox[{"getVariationList", "[", "level", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"loopEquations", "=", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"createResolventLoopEquation", "[", 
            RowBox[{"variation", ",", "matrixNumber"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"variation", ",", "variationList"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"matrixNumber", ",", "matrixIndexRange"}], "}"}]}], 
          "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GenerateIndividualResolventLoopEquation", "[", 
     RowBox[{"wordList_", ",", "matrixNumber_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"createResolventLoopEquation", "[", 
       RowBox[{"wordList", ",", "matrixNumber"}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GenerateAllCorrelatorLoopEquations", "[", "level_", "]"}], ":=", 
    
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "variationList", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"variationList", "=", 
        RowBox[{"getVariationList", "[", "level", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"createCorrelatorLoopEquation", "[", 
           RowBox[{"variation", ",", "matrixNumber"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"variation", ",", "variationList"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"matrixNumber", ",", "matrixIndexRange"}], "}"}]}], 
         "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GenerateIndividualCorrelatorLoopEquation", "[", 
     RowBox[{"wordList_", ",", "matrixNumber_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"createCorrelatorLoopEquation", "[", 
       RowBox[{"wordList", ",", "matrixNumber"}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetResolventVariables", "[", "level_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "resolventWordsList", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"resolventWordsList", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"resolventWords", "[", "i", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "level"}], "}"}]}], "]"}], ",", 
          "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(", 
        RowBox[{"List", "@@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Subscript", "[", 
             RowBox[{"\[Omega]", ",", "#"}], "]"}], "&"}], "/@", 
           "resolventWordsList"}], ")"}]}], ")"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetCorrelatorVariables", "[", "level_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "correlatorWordsList", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"correlatorWordsList", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"correlatorWords", "[", "i", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "level"}], "}"}]}], "]"}], ",", 
          "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(", 
        RowBox[{"List", "@@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Subscript", "[", 
             RowBox[{"p", ",", "#"}], "]"}], "&"}], "/@", 
           "correlatorWordsList"}], ")"}]}], ")"}]}]}], "\[IndentingNewLine]",
      "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetResolventLoopEquationLevel", "[", "loopEquation_", "]"}], ":=", 
    RowBox[{"Max", "[", 
     RowBox[{"Map", "[", 
      RowBox[{"Length", ",", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"extractIndices", "[", 
           RowBox[{"#", ",", "\[Omega]"}], "]"}], "&"}], ",", 
         RowBox[{"List", "@@", 
          RowBox[{"Expand", "[", "loopEquation", "]"}]}]}], "]"}]}], "]"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetCorrelatorLoopEquationLevel", "[", "loopEquation_", "]"}], ":=", 
    RowBox[{"Max", "[", 
     RowBox[{"Map", "[", 
      RowBox[{"Length", ",", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"extractIndices", "[", 
           RowBox[{"#", ",", "p"}], "]"}], "&"}], ",", 
         RowBox[{"List", "@@", 
          RowBox[{"Expand", "[", "loopEquation", "]"}]}]}], "]"}]}], "]"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetVariationList", "[", "level_", "]"}], ":=", 
    RowBox[{"getVariationList", "[", "level", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 CellChangeTimes->{{3.902837719733182*^9, 3.902837755976961*^9}, {
   3.9028377991220713`*^9, 3.902838039762063*^9}, {3.902838078986682*^9, 
   3.902838079424109*^9}, {3.9028381538801193`*^9, 3.902838156080084*^9}, {
   3.902838457730029*^9, 3.902838458475628*^9}, {3.902838537413492*^9, 
   3.90283860474251*^9}, {3.902838643480392*^9, 3.902838644121719*^9}, {
   3.9028386879661217`*^9, 3.902838734976413*^9}, {3.90284962688962*^9, 
   3.9028497014821167`*^9}, {3.9028524014570208`*^9, 3.902852427924158*^9}, {
   3.9028524592343187`*^9, 3.902852488676011*^9}, 3.90285252849444*^9, {
   3.902852580677486*^9, 3.902852624234001*^9}, {3.902852736496092*^9, 
   3.902852737974286*^9}, {3.9028527957616158`*^9, 3.902852992945952*^9}, {
   3.902853092037314*^9, 3.902853106712895*^9}, 3.90289256748169*^9, {
   3.902893868627939*^9, 3.9028938687775593`*^9}, {3.902893933762698*^9, 
   3.902893954229723*^9}, 3.902897448726963*^9, 3.902900614770535*^9, {
   3.90290068538767*^9, 3.902900691455209*^9}, {3.902900722781838*^9, 
   3.902900728313645*^9}, {3.902900802622912*^9, 3.902900804423473*^9}, {
   3.9029008353690367`*^9, 3.902900871463532*^9}, {3.9029009417343473`*^9, 
   3.9029010323044443`*^9}, {3.9029010816805687`*^9, 3.902901130283835*^9}, {
   3.902901173685668*^9, 3.902901202048553*^9}, {3.902901240868079*^9, 
   3.902901241432577*^9}, {3.9029014445945473`*^9, 3.90290144770494*^9}, {
   3.902901482572197*^9, 3.9029014830132*^9}, {3.9029015446116447`*^9, 
   3.9029016120736*^9}, {3.9029023618577843`*^9, 3.902902371689356*^9}, {
   3.902902797644619*^9, 3.902902820546013*^9}, {3.902903105409193*^9, 
   3.902903113377116*^9}, {3.902903152056603*^9, 3.902903232056909*^9}, {
   3.902903487153985*^9, 3.902903518497726*^9}, {3.902904071199053*^9, 
   3.902904088725698*^9}, {3.9029042753695383`*^9, 3.902904342985483*^9}, {
   3.902904373304226*^9, 3.902904378107499*^9}, {3.90290442701458*^9, 
   3.902904435614831*^9}, {3.9029093423159237`*^9, 3.902909359216969*^9}, {
   3.902909642573534*^9, 3.902909683880169*^9}, {3.902909795344557*^9, 
   3.902909796468918*^9}, {3.90290987004463*^9, 3.9029099385976257`*^9}, {
   3.902909983912369*^9, 3.902909997350898*^9}, {3.902910597397657*^9, 
   3.902910601024393*^9}, 3.90291101866995*^9, {3.90291105070267*^9, 
   3.9029110509575167`*^9}, {3.902911089890585*^9, 3.9029110920011683`*^9}, {
   3.902911124694064*^9, 3.902911148301423*^9}, {3.9029111902180157`*^9, 
   3.902911214247582*^9}, {3.9029114173661337`*^9, 3.902911434416339*^9}, {
   3.902911480946617*^9, 3.902911489853199*^9}, {3.902911756718821*^9, 
   3.902911760024469*^9}, 3.90291327111096*^9, 3.902915438544676*^9, 
   3.9029166371734037`*^9, {3.9029168633566008`*^9, 3.902916882396654*^9}, {
   3.90291943407193*^9, 3.902919684248106*^9}, {3.902919740197805*^9, 
   3.90291974875282*^9}, {3.902920124387248*^9, 3.902920126301256*^9}, {
   3.903035161456953*^9, 3.903035208717559*^9}, {3.9030356373377123`*^9, 
   3.903035738289043*^9}, {3.9030357814756517`*^9, 3.903035810607087*^9}, {
   3.903035846673538*^9, 
   3.9030358524339743`*^9}},ExpressionUUID->"85d114b0-adb3-4fad-af5e-\
9dc52adefad3"],

Cell[BoxData["\<\"LoopEquations`Private`\"\>"], "Output",
 CellChangeTimes->{
  3.902909948298805*^9, 3.902910010845389*^9, 3.902911034398162*^9, {
   3.902911214734536*^9, 3.902911224042193*^9}, 3.902911447418952*^9, 
   3.902911509400837*^9, 3.902913289766271*^9, 3.902916648328693*^9, {
   3.902916866112255*^9, 3.902916882995411*^9}, {3.902919728500901*^9, 
   3.9029197569788227`*^9}, {3.902920720883565*^9, 3.902920731674521*^9}, 
   3.903035223999909*^9, 3.903035742543153*^9},
 CellLabel->
  "Out[103]=",ExpressionUUID->"34b97643-34eb-4390-8d9e-a0cf90a7814b"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Potts3Action", "=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      FractionBox[
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["t", "2"], "-", "1"}], ")"}], "2"], 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["X", "0"], "2"], "+", 
        SuperscriptBox[
         SubscriptBox["X", "1"], "2"], "+", 
        SuperscriptBox[
         SubscriptBox["X", "2"], "2"]}], ")"}]}], "-", 
     RowBox[{
      SubscriptBox["X", "0"], 
      SubscriptBox["X", "1"]}], "-", 
     RowBox[{
      SubscriptBox["X", "1"], 
      SubscriptBox["X", "2"]}], "-", 
     RowBox[{
      SubscriptBox["X", "2"], 
      SubscriptBox["X", "0"]}], "+", 
     RowBox[{
      FractionBox[
       SubscriptBox["t", "3"], "3"], 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["X", "0"], "3"], "+", 
        SuperscriptBox[
         SubscriptBox["X", "1"], "3"], "+", 
        SuperscriptBox[
         SubscriptBox["X", "2"], "3"]}], ")"}]}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"matrixDOF", "=", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["X", "0"], ",", 
     SubscriptBox["X", "1"], ",", 
     SubscriptBox["X", "2"]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"orientationMatrix", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"maxLevel", "=", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"InitializeLoopEquationsPackage", "[", 
  RowBox[{
  "Potts3Action", ",", "matrixDOF", ",", "orientationMatrix", ",", "maxLevel",
    ",", "\[Omega]", ",", "p", ",", "z"}], "]"}]}], "Input",
 CellChangeTimes->{{3.902909956855595*^9, 3.902909958039184*^9}, {
  3.902910008716997*^9, 3.902910008779916*^9}, {3.902911060265925*^9, 
  3.902911081660348*^9}, {3.902913487039106*^9, 3.9029134871218452`*^9}},
 CellLabel->
  "In[105]:=",ExpressionUUID->"7dfd4c26-0350-4450-ad13-17cc4ca26239"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Potts2Action", "=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      FractionBox[
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["t", "2"], "-", "1"}], ")"}], "2"], 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["X", "0"], "2"], "+", 
        SuperscriptBox[
         SubscriptBox["X", "1"], "2"]}], ")"}]}], "-", 
     RowBox[{
      SubscriptBox["X", "0"], 
      SubscriptBox["X", "1"]}], "+", 
     RowBox[{
      FractionBox[
       SubscriptBox["t", "3"], "3"], 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["X", "0"], "3"], "+", 
        SuperscriptBox[
         SubscriptBox["X", "1"], "3"]}], ")"}]}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"matrixDOF", "=", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["X", "0"], ",", 
     SubscriptBox["X", "1"]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"orientationMatrix", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"maxLevel", "=", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"InitializeLoopEquationsPackage", "[", 
  RowBox[{
  "Potts2Action", ",", "matrixDOF", ",", "orientationMatrix", ",", "maxLevel",
    ",", "\[Omega]", ",", "p", ",", "z"}], "]"}]}], "Input",
 CellChangeTimes->{{3.902916792274436*^9, 3.9029168150266323`*^9}, {
  3.902916872959449*^9, 3.90291687303892*^9}},
 CellLabel->
  "In[145]:=",ExpressionUUID->"89a066f0-ba6c-4ec4-9264-d215ce339489"]
}, Open  ]]
},
WindowSize->{Full, Full},
WindowMargins->{{316, Automatic}, {Automatic, 50}},
FrontEndVersion->"13.3 for Mac OS X ARM (64-bit) (July 24, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"51aa09f5-c5fe-4667-b941-705a97f28a84"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 150, 3, 98, "Title",ExpressionUUID->"cfe02fac-2679-4ae1-928a-baf699bfc0bd"],
Cell[CellGroupData[{
Cell[755, 29, 66907, 1663, 6254, "Input",ExpressionUUID->"85d114b0-adb3-4fad-af5e-9dc52adefad3"],
Cell[67665, 1694, 567, 9, 34, "Output",ExpressionUUID->"34b97643-34eb-4390-8d9e-a0cf90a7814b"]
}, Open  ]],
Cell[68247, 1706, 2198, 67, 133, "Input",ExpressionUUID->"7dfd4c26-0350-4450-ad13-17cc4ca26239"],
Cell[70448, 1775, 1667, 52, 133, "Input",ExpressionUUID->"89a066f0-ba6c-4ec4-9264-d215ce339489"]
}, Open  ]]
}
]
*)

